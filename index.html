<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>課表暨調課查詢系統</title>
<style>
:root {
    --primary-bg: #f8f9fa;
    --header-bg: #005a87;
    --text-color: #333;
    --border-color: #dee2e6;
    --accent-color: #007bff;
    --modal-bg: #fff;
    --modal-shadow: rgba(0,0,0,0.2);
    --table-header-bg: #e9ecef;
    --highlight-bg: #fff3cd;
    --suggestion-bg: #d1e7dd;
    --suggestion-border: #a3cfbb;
    --cleared-bg: #fdfdfd;
    --list-item-hover-bg: #e9ecef;
}
body {
    font-family: 'Biaukaifang TC', 'DFKai-SB', 'Kaiti', kai-serif, serif;
    background-color: var(--primary-bg);
    color: var(--text-color);
    margin: 0;
    padding: 10px;
    line-height: 1.6;
}
.container {
    max-width: 1500px;
    margin: 0 auto;
    background: var(--modal-bg);
    padding: 20px 30px;
    border-radius: 8px;
    box-shadow: 0 4px 8px var(--modal-shadow);
}
.main-header {
    position: relative;
    text-align: center;
    margin-bottom: 2em;
}
h1 {
    margin: 0;
    display: inline-block;
    color: var(--header-bg);
}
.control-group {
    display: flex;
    align-items: center;
    gap: 8px;
    justify-content: center;
}
.selector-container {
    position: absolute;
    font-size: 1.4em;
    top: 50%;
    left: 15px;
    right: 15px;
    transform: translateY(-50%);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
}
.selector-container label {
    font-size: 1.2em;
    color: var(--text-color);
}
#class-selector, #location-selector, #search-teacher {
    font-size: 1em;
    padding: 5px 8px;
    border-radius: 4px;
    border: 1px solid #ccc;
    font-family: inherit;
}
#search-teacher {
    width: 150px;
}
.hidden {
    display: none !important;
}

/* --- 按鈕樣式 --- */
.view-toggle-btn {
    padding: 5px 10px;
    border: 1px solid var(--header-bg);
    background-color: white;
    color: var(--header-bg);
    cursor: pointer;
    border-radius: 4px;
    font-size: 14px;
    font-family: inherit;
}
.view-toggle-btn.active {
    background-color: var(--header-bg);
    color: white;
}

/* --- 核心排版樣式 (最終修正版) --- */
#teacher-list-container, #teacher-list-by-subject-container {
    column-count: 6; /* 設定為五個欄位 */
    column-gap: 6px; /* 設定欄位間距 */
}
.department-table {
    break-inside: avoid; /* 避免單個表格被從中間切斷 */
    margin-bottom: 15px; /* 增加表格之間的垂直間距 */
    width: 100%;
    border-collapse: collapse;
    font-size: 15px;
}

.department-table th {
    background-color: var(--header-bg);
    color: white;
    padding: 0px;
    text-align: center;
    font-weight: normal;
}
.department-table td {
    border: 1px solid var(--border-color);
    padding: 2px 6px;
    white-space: normal; /* 【關鍵修正】允許文字正常換行，解決重疊問題 */
    text-align: center;
}
.department-table .name-cell {
    width: 80px;
    cursor: pointer;
    color: var(--accent-color); /* 新增：使用系統定義的藍色 */
    text-decoration: underline; /* 新增：加上底線 */
}
.department-table .ext-cell {
    width: 50px;
}

/* --- Modal 彈出視窗相關樣式 --- */
.modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
.modal-content {
    margin: 2% auto; padding: 5px 15px; border: 1px solid var(--border-color); width: 100%;
    border-radius: 8px; box-shadow: 0 5px 15px var(--modal-shadow); position: relative; background-color: var(--modal-bg);
}
.main-modal .modal-content { max-width: 1000px; }
.sub-modal .modal-content { max-width: 480px; text-align: center; padding: 20px; }

.close-button { color: #aaa; position: absolute; top: 10px; right: 25px; font-size: 28px; font-weight: bold; cursor: pointer; }
.close-button:hover, .close-button:focus { color: #333; }
#modal-title { text-align: center; margin-top: 0; margin-bottom: 0px; color: var(--header-bg); }
#modal-title2 { text-align: center; margin-top: 0; font-size: 20px; margin-bottom: 0px; color: blue; }

/* --- 單節課匯出 Modal --- */
#single-event-modal h3 { margin-top: 0; color: var(--header-bg); }
#single-event-modal p { margin: 8px 0; }
#single-event-modal div { margin-bottom: 10px; }
#single-event-modal label { display: block; margin-bottom: 5px; text-align: left; }
#single-event-modal input[type="date"], #single-event-modal textarea {
    font-family: inherit; font-size: 1em; padding: 5px;
    border: 1px solid #ccc; border-radius: 4px;
    width: 95%; box-sizing: border-box;
}
#single-event-modal button {
    padding: 8px 16px; font-size: 1em; font-family: inherit;
    border: 1px solid var(--header-bg); background-color: var(--header-bg); color: white;
    cursor: pointer; border-radius: 4px;
}
#single-event-modal button:hover { background-color: #004a6e; }

/* --- 課表表格相關樣式 --- */
.schedule-table { width: 100%; border-collapse: collapse; table-layout: fixed; }
.schedule-table th, .schedule-table td {
    border: 1px solid #999;
    padding: 4px; text-align: center; vertical-align: middle;
    word-wrap: break-word; box-sizing: border-box;
    position: relative;
}
.schedule-table th { background-color: var(--table-header-bg); font-weight: bold; height: 20px; }
.schedule-table th:first-child,
.schedule-table td:first-child { width: 6%; }
.schedule-table td {
    font-size: 16px; height: 68px; cursor: pointer; transition: background-color 0.2s; background-color: var(--modal-bg);
}
.schedule-table td.empty-cell { background-color: var(--cleared-bg); }
.schedule-table td:hover { background-color: #f0f0f0; }
.schedule-table td.empty-cell:hover, .schedule-table td.cleared-cell:hover { background-color: transparent; cursor: default; }
.schedule-table .period-header { font-weight: bold; background-color: var(--table-header-bg); }
.schedule-table .subject { font-weight: normal; display: block; }
.schedule-table .details { font-size: 14px; color: #555; display: block; line-height: 1.1; }
.highlight { background-color: var(--highlight-bg) !important; box-shadow: 0 0 5px rgba(0,0,0,0.3); }

/* --- 調課建議相關樣式 --- */
.swap-suggestion {
    background-color: var(--suggestion-bg) !important;
    color: #0f5132;
    outline: 2px dashed var(--suggestion-border);
    outline-offset: -2px;
}
.swap-suggestion .subject, .swap-suggestion .details {color: #0f5132;  line-height: 1.1;}
.swap-suggestion .teacher-detail,
.swap-suggestion .ext-detail {
    display: inline;
    margin-left: 4px;
}
.swap-suggestion .class-detail {
    display: block;
}
.swap-suggestion .class-detail + .teacher-detail {
    margin-left: 0;
}
.cleared-cell { background-color: var(--cleared-bg); }

/* --- 手機版響應式樣式 --- */
@media screen and (max-width: 768px) {
    body {
        padding: 5px;
        -webkit-text-size-adjust: 100%;
    }
    .container {
        padding: 10px;
    }
    .close-button { top: 10px; right: 25px; font-size: 28px; font-weight: bold; }
    .main-header {
        position: static;
        text-align: center;
        margin-bottom: 2em;
    }
    h1 {
       font-size: 1.5em;
       display: block;
       width: 100%;
    }
	.selector-container {
        font-size: 1em;
        position: static;
        transform: none;
        margin-top: 15px;
        justify-content: center;
        width: 100%;
        flex-wrap: wrap; /* 允許換行 */
        gap: 15px; /* 當元件換行時的垂直間距 */
    }	
    .img-container {
        font-size: 1em;
        position: static;
        transform: none;
        margin-top: 5px;
        justify-content: center;
        width: 5%;
    }

    .modal-content {
        width: 90%;
    }
    #modal-title2 { font-size: 16px; }

    /* 修正手機版主頁面排版 */
    #teacher-list-container, #teacher-list-by-subject-container {
        column-count: 1; /* 在窄螢幕下，強制所有列表變為單欄佈局 */
    }
    .department-table {
        font-size: 14px;
    }
    #search-teacher { width: 120px; }

    /* 修正手機版課表排版 */
    .schedule-table td {
        font-size: 12px;
        height: 72px;
    }
     .schedule-table .details {
        font-size: 10px;
    }
    .swap-suggestion .details {
       display: block;
       margin-left: 0px;
       line-height: 1.2;
    }
}
</style>

</head>
<body>

    <div class="container">
        <div class="main-header">
			<div class="selector-container">
                <div class="control-group">
                    <input type="search" id="search-teacher" placeholder="搜尋教師...">
                </div>
                <div class="control-group">
                    <span>教師名單：</span>
                    <button id="view-by-dept-btn" class="view-toggle-btn active">依單位</button>
                    <button id="view-by-subject-btn" class="view-toggle-btn">依領域</button>
                </div>
                <div class="control-group">
                    <select id="location-selector"><option value="" disabled selected>場地課表</option></select>
                    <select id="class-selector"><option value="" disabled selected>班級課表</option></select>
                </div>
            </div>
		</div>

        <div id="teacher-list-column">
            <div id="teacher-list-container"></div>
            <div id="teacher-list-by-subject-container" style="display: none;"></div>
        </div>
    </div>

    <div id="schedule-modal" class="modal main-modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
			<h2 id="modal-title"></h2><h2 id="modal-title2"></h2>
            <div id="reminder-container"></div>
            <div id="modal-body"></div>
        </div>
    </div>

    <div id="single-event-modal" class="modal sub-modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3>將課程加入行事曆</h3>
            <p id="single-event-info"></p>
            <div>
                <label for="single-event-date">選擇日期：</label>
                <input type="date" id="single-event-date">
            </div>
            <div>
                <label for="event-notes">註記 (例如：小考、交作業)：</label>
                <textarea id="event-notes" rows="3" placeholder="此處的文字將會顯示在行事曆事件的說明中..."></textarea>
            </div>
            <p><button id="download-single-ics-btn">下載 .ics 檔案</button></p>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- 1. RAW DATA ---
    const classStartTimes = {
        1: '08:10', 2: '09:10', 3: '10:10', 4: '11:10',
        5: '13:10', 6: '14:10', 7: '15:10', 8: '16:10'
    };

    const csvClassSchedule = `"101
陳信全",星期一,星期二,星期三,星期四,星期五
1,"英語文
方淑貞","英語文
方淑貞","國語文
黃耀慧","生物
鄭雅茵","體育
潘薇安"
2,"國語文
黃耀慧","閱讀得來素
張耕翰","資訊科技
蔣銘宗
電腦教室3","歷史
陳銘漢","生活科技
吳建璿
生活科技"
3,"綜合活動
黃美玲","數學
陳銘漢","體育
潘薇安","健康教育
鍾育倫","音樂
張詩佳"
4,"綜合活動
黃美玲","國語文
黃耀慧","地理
張耕翰","表演藝術
洪婉郡","國語文
黃耀慧"
5,"數學
陳銘漢","輔導活動
劉庭瑜","班級輔導
陳信全","數學
陳銘漢","數學
陳銘漢"
6,"公民與社會
方瑋樺","生聲相惜
黃美玲","本土語言
許雅玲","國語文
黃耀慧","金中講堂
陳信全"
7,"生物
鄭雅茵","探世界說生活
曾翔蔚","生物
鄭雅茵","英語文
方淑貞","視覺藝術
陳信全"
8,"課業輔導
陳信全","課業輔導
陳信全","課業輔導
陳信全","課業輔導
陳信全",
,,,,,
"102
黃耀慧",星期一,星期二,星期三,星期四,星期五
1,"國語文
黃耀慧","體育
潘薇安","資訊科技
蔣銘宗
電腦教室3","生物
黃婉婷","國語文
黃耀慧"
2,"健康教育
鍾育倫","英語文
方淑貞","表演藝術
洪婉郡","公民與社會
方瑋樺","音樂
張詩佳"
3,"數學
陳銘漢","國語文
黃耀慧","生物
黃婉婷","英語文
方淑貞","生活科技
吳建璿
生活科技"
4,"生物
黃婉婷","閱讀得來素
張耕翰","國語文
黃耀慧","數學
陳銘漢","視覺藝術
陳信全"
5,"本土語言
許雅玲","數學
陳銘漢","班級輔導
黃耀慧","國語文
黃耀慧","輔導活動
劉庭瑜"
6,"綜合活動
黃美玲","探世界說生活
曾翔蔚","地理
張耕翰","生聲相惜
黃美玲","金中講堂
黃耀慧"
7,"綜合活動
黃美玲","歷史
陳銘漢","英語文
方淑貞","體育
潘薇安","數學
陳銘漢"
8,"課業輔導
黃耀慧","課業輔導
黃耀慧","課業輔導
黃耀慧","課業輔導
黃耀慧",
,,,,,
"103
方淑貞",星期一,星期二,星期三,星期四,星期五
1,"綜合活動
龔偉遜","國語文
游麗萍","本土語言
許雅玲","國語文
游麗萍","生活科技
吳建璿
生活科技"
2,"綜合活動
龔偉遜","數學
蘇威光","生物
黃婉婷","生物
黃婉婷","國語文
游麗萍"
3,"數學
蘇威光","資訊科技
蔣銘宗
電腦教室3","視覺藝術
陳信全","數學
蘇威光","表演藝術
洪婉郡"
4,"國語文
游麗萍","歷史
陳銘漢","體育
潘薇安","英語文
方淑貞","音樂
張詩佳"
5,"生物
黃婉婷","英語文
方淑貞","班級輔導
方淑貞","健康教育
鍾育倫","閱讀得來素
鍾育倫"
6,"體育
潘薇安","地理
徐紹青","國語文
游麗萍","探世界說生活
方淑貞","金中講堂
方淑貞"
7,"輔導活動
龔偉遜","生聲相惜
黃美玲","數學
蘇威光","公民與社會
方瑋樺","英語文
方淑貞"
8,"課業輔導
方淑貞","課業輔導
方淑貞","課業輔導
方淑貞","課業輔導
方淑貞",
,,,,,
"104
游麗萍",星期一,星期二,星期三,星期四,星期五
1,"國語文
游麗萍","閱讀得來素
張耕翰","數學
蘇威光","數學
蘇威光","音樂
張詩佳"
2,"英語文
方淑貞","國語文
游麗萍","英語文
方淑貞","健康教育
鍾育倫","數學
蘇威光"
3,"生物
黃婉婷","本土語言
許雅玲","國語文
游麗萍","生物
黃婉婷","輔導活動
劉庭瑜"
4,"體育
潘薇安","資訊科技
蔣銘宗
電腦教室3","生物
黃婉婷","國語文
游麗萍","生活科技
吳建璿
生活科技"
5,"公民與社會
方瑋樺","地理
徐紹青","班級輔導
游麗萍","表演藝術
洪婉郡","體育
潘薇安"
6,"探世界說生活
曾翔蔚","英語文
方淑貞","綜合活動
龔偉遜","歷史
陳銘漢","金中講堂
游麗萍"
7,"數學
蘇威光","視覺藝術
陳信全","綜合活動
龔偉遜","生聲相惜
黃美玲","國語文
游麗萍"
8,"課業輔導
游麗萍","課業輔導
游麗萍","課業輔導
游麗萍","課業輔導
游麗萍",
,,,,,
"201
蘇威光",星期一,星期二,星期三,星期四,星期五
1,"理化
李承修","國語文
劉芝妤","動動金手指
李承修
化學實驗室1","資訊科技
蔣銘宗
電腦教室3","童軍教育
龔偉遜"
2,"數學
蘇威光","表演藝術
洪婉郡","數學
蘇威光","本土語言
許雅玲","童軍教育
龔偉遜"
3,"輔導活動
劉庭瑜","數學
蘇威光","英語文
江紹瑄","生活科技
吳建璿
生活科技","歷史
林嘉慧"
4,"音樂
張詩佳","視覺藝術
陳信全","理化
李承修","地理
徐紹青","國語文
劉芝妤"
5,"國語文
劉芝妤","公民與社會
方瑋樺","班級輔導
蘇威光","國語文
劉芝妤","英語文
江紹瑄"
6,"體育
陳毅芬","理化
李承修","國語文
劉芝妤","體育
陳毅芬","金中講堂
蘇威光"
7,"英語文
江紹瑄","健康教育
鍾育倫","藍色世界探索
江紹瑄","數學
蘇威光","社團
林宏譯"
8,"國文.輔
劉芝妤","生物輔
蘇家逸","英文.輔
江紹瑄","數學.輔
蘇威光",
,,,,,
"202
劉芝妤",星期一,星期二,星期三,星期四,星期五
1,"視覺藝術
陳信全","童軍教育
龔偉遜","表演藝術
洪婉郡","英語文
江紹瑄","理化
李承修"
2,"公民與社會
方瑋樺","童軍教育
龔偉遜","國語文
劉芝妤","生活科技
吳建璿
生活科技","國語文
劉芝妤"
3,"藍色世界探索
江紹瑄","英語文
江紹瑄","理化
李承修","本土語言
許雅玲","動動金手指
李承修
化學實驗室1"
4,"健康教育
鍾育倫","數學
蘇威光","數學
蘇威光","國語文
劉芝妤","歷史
林嘉慧"
5,"數學
蘇威光","體育
陳毅芬","班級輔導
劉芝妤","地理
徐紹青","數學
蘇威光"
6,"理化
李承修","音樂
張詩佳","英語文
江紹瑄","資訊科技
蔣銘宗
電腦教室3","金中講堂
劉芝妤"
7,"國語文
劉芝妤","國語文
劉芝妤","輔導活動
劉庭瑜","體育
陳毅芬","社團
吳裕隆"
8,"數學.輔
蘇威光","英文輔
許仲璦","國文.輔
劉芝妤","英語文,輔
江紹瑄",
,,,,,
"203
洪婉郡",星期一,星期二,星期三,星期四,星期五
1,"國語文
張耕翰","表演藝術
洪婉郡","英語文
江紹瑄","生活科技
吳建璿
生活科技","本土語言
許雅玲"
2,"輔導活動
劉庭瑜","藍色世界探索
江紹瑄","歷史
林嘉慧","資訊科技
蔣銘宗
電腦教室3","動動金手指
王皓正
化學實驗室1"
3,"理化
王皓正","童軍教育
龔偉遜","國語文
張耕翰","體育
潘薇安","英語文
江紹瑄"
4,"英語文
江紹瑄","童軍教育
龔偉遜","視覺藝術
陳信全","數學
蔡佳樺","理化
王皓正"
5,"音樂
張詩佳","數學
蔡佳樺","班級輔導
洪婉郡","理化
王皓正","國語文
張耕翰"
6,"數學
蔡佳樺","公民與社會
方瑋樺","健康教育
鍾育倫","地理
徐紹青","金中講堂
洪婉郡"
7,"體育
潘薇安","國語文
張耕翰","數學
蔡佳樺","國語文
張耕翰","社團
社團師10"
8,"英文.輔
江紹瑄","數學.輔
蔡佳樺","國文.輔
張耕翰","課業輔導
洪婉郡",
,,,,,
"204
蔡佳樺",星期一,星期二,星期三,星期四,星期五
1,"英語文
江紹瑄","數學
蔡佳樺","歷史
林嘉慧","地理
徐紹青","動動金手指
鄭雅茵
化學實驗室1"
2,"國語文
許雅玲","本土語言
許雅玲","公民與社會
方瑋樺","理化
鄭雅茵","藍色世界探索
江紹瑄"
3,"童軍教育
龔偉遜","視覺藝術
陳信全","國語文
許雅玲","英語文
江紹瑄","數學
蔡佳樺"
4,"童軍教育
龔偉遜","輔導活動
劉庭瑜","數學
蔡佳樺","生活科技
吳建璿
生活科技","國語文
許雅玲"
5,"數學
蔡佳樺","英語文
江紹瑄","班級輔導
蔡佳樺","體育
潘薇安","理化
鄭雅茵"
6,"音樂
張詩佳","體育
潘薇安","理化
鄭雅茵","國語文
許雅玲","金中講堂
蔡佳樺"
7,"健康教育
鍾育倫","國語文
許雅玲","表演藝術
洪婉郡","資訊科技
蔣銘宗
電腦教室3","社團
黃美玲"
8,"課業輔導
蔡佳樺","英語文.輔
江紹瑄","地理.輔
徐紹青","數學.輔
蔡佳樺",
,,,,,
"301
陳毅芬",星期一,星期二,星期三,星期四,星期五
1,"英語文
黃政榕","國語文
何新梅","公民與社會
方瑋樺","理化
李承修","家政教育
黃美玲
烹飪教室1"
2,"數學
蔡佳樺","地理
郭仲怡","生活科技
吳建璿
生活科技","地球科學
李承修","家政教育
黃美玲
烹飪教室1"
3,"閱讀新南向政策與SDGs交集
何新梅","動動金手指
李承修","數學
蔡佳樺","英語文
黃政榕","國語文
何新梅"
4,"視覺藝術
陳信全","表演藝術
洪婉郡","國語文
何新梅","體育
陳毅芬","數學
蔡佳樺"
5,"國語文
何新梅","英語文
黃政榕","班級輔導
陳毅芬","音樂
張詩佳","資訊科技
蔣銘宗
電腦教室3"
6,"歷史
林孟儒","輔導活動
李清波","夢想啟航
黃政榕","國語文
何新梅","金中講堂
陳毅芬"
7,"體育
陳毅芬","數學
蔡佳樺","理化
李承修","健康教育
鍾育倫","補救教學
蔡佳樺"
8,,,,,
,,,,,
"302
黃政榕",星期一,星期二,星期三,星期四,星期五
1,"表演藝術
洪婉郡","英語文
黃政榕","生活科技
吳建璿
生活科技","輔導活動
李清波","數學
林宏譯"
2,"閱讀新南向政策與SDGs交集
何新梅","理化
李承修","國語文
何新梅","體育
陳毅芬","國語文
何新梅"
3,"數學
林宏譯","國語文
何新梅","歷史
林孟儒","數學
林宏譯","家政教育
黃美玲
烹飪教室1"
4,"英語文
黃政榕","體育
陳毅芬","健康教育
鍾育倫","國語文
何新梅","家政教育
黃美玲
烹飪教室1"
5,"視覺藝術
陳信全","地理
郭仲怡","班級輔導
黃政榕","資訊科技
蔣銘宗
電腦教室3","英語文
黃政榕"
6,"國語文
何新梅","夢想啟航
黃政榕","地球科學
李承修","音樂
張詩佳","金中講堂
黃政榕"
7,"理化
李承修","數學
林宏譯","公民與社會
方瑋樺","動動金手指
李承修","補救教學
林嘉慧"
8,,,,,
,,,,,
"303
陳映伶",星期一,星期二,星期三,星期四,星期五
1,"公民與社會
方瑋樺","理化
李承修","閱讀新南向政策與SDGs交集
陳映伶","家政教育
黃美玲
烹飪教室1","國語文
陳映伶"
2,"體育
陳毅芬","英語文
曾翔蔚","英語文
曾翔蔚","家政教育
黃美玲
烹飪教室1","數學
林宏譯"
3,"國語文
陳映伶","數學
林宏譯","生活科技
吳建璿
生活科技","國語文
陳映伶","體育
陳毅芬"
4,"地球科學
李承修","夢想啟航
曾翔蔚","資訊科技
蔣銘宗
電腦教室3","數學
林宏譯","表演藝術
洪婉郡"
5,"歷史
林孟儒","輔導活動
李清波","班級輔導
陳映伶","地理
郭仲怡","理化
李承修"
6,"數學
林宏譯","健康教育
鍾育倫","國語文
陳映伶","動動金手指
李承修","金中講堂
陳映伶"
7,"英語文
曾翔蔚","國語文
陳映伶","視覺藝術
陳信全","音樂
張詩佳","補救教學
許仲璦"
8,"數學.輔
林宏譯","英文輔
曾翔蔚","國文.輔
陳映伶","歷史輔.
林孟儒",
,,,,,
"304
方瑋樺",星期一,星期二,星期三,星期四,星期五
1,"家政教育
黃美玲
烹飪教室1","數學
王莉婷","夢想啟航
黃政榕","音樂
張詩佳","英語文
黃政榕"
2,"家政教育
黃美玲
烹飪教室1","英語文
黃政榕","國語文
陳映伶","輔導活動
李清波","國語文
陳映伶"
3,"地球科學
李承修","國語文
陳映伶","體育
陳毅芬","理化
李承修","資訊科技
蔣銘宗
電腦教室3"
4,"數學
王莉婷","閱讀新南向政策與SDGs交集
陳映伶","生活科技
吳建璿
生活科技","國語文
陳映伶","體育
陳毅芬"
5,"動動金手指
李承修","表演藝術
洪婉郡","班級輔導
方瑋樺","公民與社會
方瑋樺","數學
王莉婷"
6,"國語文
陳映伶","視覺藝術
陳信全","數學
王莉婷","地理
郭仲怡","金中講堂
方瑋樺"
7,"英語文
黃政榕","理化
李承修","健康教育
鍾育倫","歷史
林孟儒","補救教學
何新梅"
8,,,,,
,,,,,
"401
陳昭宏",星期一,星期二,星期三,星期四,星期五
1,"英語文
英文師1","數學
陳昭宏","生物
黃婉婷","國語文
范麗萍","英語文
英文師1"
2,"數學
陳昭宏","生涯規劃
劉庭瑜","國語文
范麗萍","化學
王皓正","國語文
范麗萍"
3,"生活科技
蔣銘宗
生活科技","國語文
范麗萍","音樂
張詩佳","社科概論B
方瑋樺","體育
周桂英"
4,"生活科技
蔣銘宗
生活科技","社科概論A
林孟儒","音樂
張詩佳","英語文
英文師1","健康與護理
高慧芳"
5,"全民國防教育
簡富源","數學
陳昭宏","班會
陳昭宏","本土語言
李佳樺","閱讀
許亮昇"
6,"化學
王皓正","體育
周桂英","歷史
林孟儒","歷史
林孟儒","週會
陳昭宏"
7,"生物
黃婉婷","英語文
英文師1","自主學習
陳昭宏","數學
陳昭宏","社團
陳昭宏"
8,,,,,
,,,,,
"402
張惟智",星期一,星期二,星期三,星期四,星期五
1,"生活科技
蔣銘宗
生活科技","國語文
范麗萍","國語文
范麗萍","化學
王皓正","社科概論A
林孟儒"
2,"生活科技
蔣銘宗
生活科技","國語文
范麗萍","全民國防教育
簡富源","數學
張惟智","英語文
英文師2"
3,"體育
周桂英","音樂
張詩佳","生涯規劃
劉庭瑜","英語文
英文師2","社科概論B
方瑋樺"
4,"英語文
英文師2","音樂
張詩佳","本土語言
李佳樺","生物
黃婉婷","體育
周桂英"
5,"數學
張惟智","英語文
英文師2","班會
張惟智","歷史
林孟儒","國語文
范麗萍"
6,"生物
黃婉婷","數學
張惟智","數學
張惟智","自主學習
張惟智","週會
張惟智"
7,"化學
王皓正","健康與護理
高慧芳","歷史
林孟儒","閱讀
蔡千慧","社團
張耕翰"
8,,,,,
,,,,,
"403
余玥林",星期一,星期二,星期三,星期四,星期五
1,"全民國防教育
簡富源","社科概論A
謝依萍","音樂
張詩佳","體育
周桂英","本土語言
陳映如"
2,"地理
謝依萍","數學
張惟智","音樂
張詩佳","地理
謝依萍","英語文
英文師3"
3,"自然科學概論
蔡維騰","自主學習
余玥林","數學
張惟智","英語文
英文師3","數學
張惟智"
4,"英語文
英文師3","社科概論B
方瑋樺","健康與護理
高慧芳","閱讀
蔡千慧","國語文
張嘉雯"
5,"國語文
張嘉雯","英語文
英文師3","班會
余玥林","生涯規劃
劉庭瑜","物理
林文杰"
6,"生活科技
蔣銘宗
生活科技","物理
林文杰","國語文
張嘉雯","自然科學概論
蔡維騰","週會
余玥林"
7,"生活科技
蔣銘宗
生活科技","體育
周桂英","國語文
張嘉雯","數學
張惟智","社團
徐紹青"
8,,,,,
,,,,,
"404
王怡文",星期一,星期二,星期三,星期四,星期五
1,"英語文
英文師4","數學
游靜玟","物理
林文杰","閱讀
蔡千慧","英語文
英文師4"
2,"國語文
張嘉雯","自然科學概論
蔡維騰","地理
陳靜誼","體育
潘薇安","本土語言
陳映如"
3,"數學
游靜玟","體育
潘薇安","國語文
張嘉雯","數學
游靜玟","國語文
張嘉雯"
4,"健康與護理
高慧芳","地理
陳靜誼","生涯規劃
劉庭瑜","英語文
英文師4","社科概論B
方瑋樺"
5,"物理
林文杰","社科概論A
陳靜誼","班會
王怡文","國語文
張嘉雯","自然科學概論
蔡維騰"
6,"資訊科技概論
洪華欣
電腦教室2","自主學習
王怡文","數學
游靜玟","美術
陳信全","週會
王怡文"
7,"資訊科技概論
洪華欣
電腦教室2","英語文
英文師4","全民國防教育
簡富源","美術
陳信全","社團
蔡維騰"
8,,,,,
,,,,,
"405
許亮昇",星期一,星期二,星期三,星期四,星期五
1,"英語文
英文師5","國語文
張嘉雯","閱讀
許亮昇","體育
潘薇安","英語文
英文師5"
2,"原住民樂舞
譚雅婷","自主學習
譚雅婷","原住民史文
黃曉慧","原住民史文
黃曉慧","國語文
張嘉雯"
3,"地理
謝依萍","數學
游靜玟","全民國防教育
簡富源","生涯規劃
劉庭瑜","資訊科技概論
洪華欣
電腦教室2"
4,"數學
游靜玟","物理
林文杰","國語文
張嘉wen","英語文
英文師5","資訊科技概論
洪華欣
電腦教室2"
5,"原住民樂舞
譚雅婷","體育
潘薇安","班會
許亮昇","本土語言
許亮昇","數學
游靜玟"
6,"美術
黃瑋瑤","地理
謝依萍","物理
林文杰","數學
游靜玟","週會
許亮昇"
7,"美術
黃瑋瑤","英語文
英文師5","健康與護理
高慧芳","國語文
張嘉雯","社團
龔偉遜"
8,,,,,
,,,,,
"406
蔡千慧",星期一,星期二,星期三,星期四,星期五
1,"歷史
王怡文","化學
簡秀萍","閱讀
蔡千慧","美術
陳信全","體育
周桂英"
2,"生物
李政學","數學
吳銘川","環境觀測技術
蔡維騰","美術
陳信全","英語文
英文師6"
3,"全民國防教育
簡富源","資訊科技概論
洪華欣
電腦教室2","體育
周桂英","英語文
英文師6","國語文
范麗萍"
4,"英語文
英文師6","資訊科技概論
洪華欣
電腦教室2","數學
吳銘川","國語文
范麗萍","自主學習
蔡千慧"
5,"健康與護理
高慧芳","英語文
英文師6","班會
蔡千慧","書報討論
林文杰","化學
簡秀萍"
6,"數學
吳銘川","國語文
范麗萍","歷史
王怡文","書報討論
林文杰","週會
蔡千慧"
7,"生涯規劃
劉庭瑜","生物
李政學","國語文
范麗萍","數學
吳銘川","社團
簡秀萍"
8,"國文.輔
蔡千慧","數學.輔
吳銘川",,"自然輔
自然師1",
,,,,,
411,星期一,星期二,星期三,星期四,星期五
1,"英語文
曾國誌",,,,"英語文
曾國誌"
2,,,,,
3,,,,,
4,,,,"英語文
曾國誌",
5,,,,,
6,,,,,
7,,"英語文
曾國誌",,,
8,,,,,
,,,,,
412,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,"英語文
曾國誌","英語文
曾國誌"
3,,,,,
4,"英語文
曾國誌",,,,
5,,"英語文
曾國誌",,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
413,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,"英語文
張淑粉"
3,,,,"英語文
張淑粉",
4,"英語文
張淑粉",,,,
5,,"英語文
張淑粉",,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
414,星期一,星期二,星期三,星期四,星期五
1,"英語文
莊世爵",,,,"英語文
莊世爵"
2,,,,,
3,,,,,
4,,,,"英語文
莊世爵",
5,,,,,
6,,,,,
7,,"英語文
莊世爵",,,
8,,,,,
,,,,,
415,星期一,星期二,星期三,星期四,星期五
1,"英語文
陳毓珍",,,,"英語文
陳毓珍"
2,,,,,
3,,,,,
4,,,,英語文,
5,,,,陳毓珍,
6,,,,,
7,,"英語文
陳毓珍",,,
8,,,,,
,,,,,
416,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,"英語文
陳毓珍"
3,,,,"英語文
陳毓珍",
4,"英語文
陳毓珍",,,,
5,,"英語文
陳毓珍",,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
"501
吳銘川",星期一,星期二,星期三,星期四,星期五
1,"國語文
李佳樺","數位科技概論
洪華欣
電腦教室2","生命啟航
高慧芳","英語文
莊世爵","會計學
汪麗鈴"
2,"會計學
汪麗鈴","數位科技概論
洪華欣
電腦教室2","經濟學
李金龍","商用數學
吳銘川","國語文
李佳樺"
3,"共同選修
共選師1","體育
黃思綺","國語文
李佳樺","共同選修
共選師1","體育
黃思綺"
4,"共同選修
共選師1","商用數學
吳銘川","英語文
莊世爵","共同選修
共選師1","商用數學
吳銘川"
5,"英語文
莊世爵","經濟學
李金龍","班會
吳銘川","專題討論
洪華欣","經濟學
李金龍"
6,"經濟學
李金龍","彈性學習
彈學師51","會計學
汪麗鈴","專題討論
洪華欣","週會
吳銘川"
7,"商業概論
汪麗鈴","彈性學習
彈學師51","商業概論
汪麗鈴","專題討論
洪華欣","社團
社團師2"
8,,,,,
,,,,,
"502
林恩宇",星期一,星期二,星期三,星期四,星期五
1,"生命啟航
高慧芳","英語文
謝佳琪","體育
周桂英","英語文
謝佳琪","國語文
李佳樺"
2,"商用數學
林恩宇","觀光餐旅實務
余玥林","烘焙實務
陳淑芬","國語文
李佳樺","英語文
謝佳琪"
3,"共同選修
共選師2","餐旅服務技術
邱歆喻","烘焙實務
陳淑芬","共同選修
共選師2","飲料實務
邱歆喻"
4,"共同選修
共選師2","餐旅服務技術
邱歆喻","烘焙實務
陳淑芬","共同選修
共選師2","飲料實務
邱歆喻"
5,"國語文
李佳樺","商用數學
林恩宇","班會
林恩宇","西餐烹調實習
潘翌展
烹飪教室1","觀餐英語會話
周正忠"
6,"觀光餐旅實務
余玥林","彈性學習
彈學師52","商用數學
林恩宇",,"週會
林恩宇"
7,"體育
周桂英","彈性學習
彈學師52","觀餐英語會話
周正忠","西餐烹調實習
潘翌展
烹飪教室1","社團
社團師3"
8,,,,"西餐烹調實習
潘翌展
烹飪教室1",
,,,,,
"503
李佳樺",星期一,星期二,星期三,星期四,星期五
1,"英語文
謝佳琪","餐旅服務技術
邱歆喻","英語文
謝佳琪","商用數學
張惟智","飲料實務
邱歆喻"
2,"體育
周桂英","餐旅服務技術
邱歆喻","西餐烹調實習
潘翌展
烹飪教室1","體育
周桂英","飲料實務
邱歆喻"
3,"共同選修
共選師3","國語文
李佳樺","西餐烹調實習
潘翌展
烹飪教室1","共同選修
共選師3","英語文
謝佳琪"
4,"共同選修
共選師3","商用數學
張惟智","西餐烹調實習
潘翌展
烹飪教室1","共同選修
共選師3","觀光餐旅實務
余玥林"
5,"觀餐英語會話
周正忠","生命啟航
高慧芳","班會
李佳樺","烘焙實務
陳淑芬","商用數學
張惟智"
6,"國語文
李佳樺","彈性學習
彈學師53","觀餐英語會話
周正忠","烘焙實務
陳淑芬","週會
李佳樺"
7,"觀光餐旅實務
余玥林","彈性學習
彈學師53","國語文
李佳樺","烘焙實務
陳淑芬","社團
社團師4"
8,,,,,
,,,,,
"504
陳靜誼",星期一,星期二,星期三,星期四,星期五
1,"公民與社會
歐姿儀","生命啟航
高慧芳","數學B
游靜玟","地理
陳靜誼","歷史
王怡文"
2,"國語文
許亮昇","公民與社會
歐姿儀","歷史
王怡文","英語文
周正忠","公民與社會
歐姿儀"
3,"共同選修
共選師4","英語文
周正忠","國語文
許亮昇","共同選修
共選師4","數學B
游靜玟"
4,"共同選修
共選師4","數學B
游靜玟","體育
周桂英","共同選修
共選師4","英語文
周正忠"
5,"地理
陳靜誼","歷史
王怡文","班會
陳靜誼","專題實作
陳靜誼","地理
陳靜誼"
6,"體育
周桂英","彈性學習
彈學師54","探究與實作
黃曉慧","專題實作
陳靜誼","週會
陳靜誼"
7,"英語文
周正忠","彈性學習
彈學師54","探究與實作
黃曉慧","國語文
許亮昇","社團
社團師9"
8,,,,,
,,,,,
"505
謝佳琪",星期一,星期二,星期三,星期四,星期五
1,"地理
陳靜誼","專題實作
陳靜誼","地理
陳靜誼","歷史
王怡文","數學B
連昱衡"
2,"數學B
連昱衡","專題實作
陳靜誼","體育
黃思綺","地理
陳靜誼","國語文
許亮昇"
3,"共同選修
共選師5","國語文
許亮昇","生命啟航
高慧芳","共同選修
共選師5","公民與社會
歐姿儀"
4,"共同選修
共選師5","英語文
謝佳琪","國語文
許亮昇","共同選修
共選師5","歷史
王怡文"
5,"體育
黃思綺","公民與社會
歐姿儀","班會
謝佳琪","數學B
連昱衡","英語文
謝佳琪"
6,"英語文
謝佳琪","彈性學習
彈學師55","英語文
謝佳琪","探究與實作
黃曉慧","週會
謝佳琪"
7,"公民與社會
歐姿儀","彈性學習
彈學師55","歷史
王怡文","探究與實作
黃曉慧","社團
社團師6"
8,,,,,
,,,,,
"506
林文杰",星期一,星期二,星期三,星期四,星期五
1,"國語文
許亮昇","國語文
許亮昇","數學A
陳昭宏","化學
簡秀萍","數學A
陳昭宏"
2,"英語文
張淑粉","數學A
陳昭宏","物理
林文杰","英語文
張淑粉","物理
林文杰"
3,"化學
簡秀萍","生命啟航
高慧芳","英語文
張淑粉","共同選修
共選師6","國語文
許亮昇"
4,"物理
林文杰","體育
周桂英","地球科學
蔡維騰","共同選修
共選師6","生物
李政學"
5,"專題實作
陳昭宏","生物
李政學","班會
林文杰","數學A
陳昭宏","英語文
張淑粉"
6,"專題實作
陳昭宏","彈性學習
彈學師56","化學
簡秀萍","體育
周桂英","週會
林文杰"
7,"專題實作
陳昭宏","彈性學習
彈學師56","國語文
許亮昇","地球科學
蔡維騰","社團
簡富源"
8,"國文.輔
許亮昇","數學.輔
陳昭宏",,"自然輔
自然師2",
,,,,,
521,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,"國際視野
陳靜誼",,,,
4,"國際視野
陳靜誼",,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
522,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,"原住民樂舞
譚雅婷",,,,
4,"原住民樂舞
譚雅婷",,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
523,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,"食品科學
陳淑芬",,,,
4,"食品科學
陳淑芬",,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
524,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,"電腦軟體應用
洪華欣
電腦教室2",,,,
4,"電腦軟體應用
洪華欣
電腦教室2",,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
525,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,"中式麵食
邱歆喻
烹飪教室1",,,,
4,"中式麵食
邱歆喻
烹飪教室1",,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
526,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,"人文社會科學
王怡文",,,,
4,"人文社會科學
王怡文",,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
527,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,"商業經營實務
龔進庭",,,,
4,"商業經營實務
龔進庭",,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
531,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,"日語
許亮昇",
4,,,,"日語
許亮昇",
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
532,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,"原民社會議題
黃曉慧",
4,,,,"原民社會議題
黃曉慧",
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
533,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,"電影配樂
譚雅婷",
4,,,,"電影配樂
譚雅婷",
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
534,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,"中式麵食
邱歆喻
烹飪教室1",
4,,,,"中式麵食
邱歆喻
烹飪教室1",
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
535,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,"電子商務概論
洪華欣
電腦教室2",
4,,,,"電子商務概論
洪華欣
電腦教室2",
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
536,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,"韓語
游娟鐶",
4,,,,"韓語
游娟鐶",
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
537,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,"半導體概論
林文杰",
4,,,,"半導體概論
林文杰",
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
538,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,"國文口語表達
梁榕真",
4,,,,"國文口語表達
梁榕真",
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
551,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,"生活數學學術
游靜玟",,,
7,,"生活數學學術
游靜玟",,,
8,,,,,
,,,,,
552,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,"主題式讀與寫
蔡千慧",,,
7,,"主題式讀與寫
蔡千慧",,,
8,,,,,
,,,,,
553,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,"生活公民議題
林孟儒",,,
7,,"生活公民議題
林孟儒",,,
8,,,,,
,,,,,
554,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,"地景漫遊
陳靜誼",,,
7,,"地景漫遊
陳靜誼",,,
8,,,,,
,,,,,
555,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,"原住民音樂
譚雅婷",,,
7,,"原住民音樂
譚雅婷",,,
8,,,,,
,,,,,
556,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,"伴手禮研製
余玥林
烹飪教室1",,,
7,,"伴手禮研製
余玥林
烹飪教室1",,,
8,,,,,
,,,,,
557,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,"自主(學科)
李佳樺",,,
7,,"自主(學科)
李佳樺",,,
8,,,,,
,,,,,
558,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,"自主(音樂)
蔡維騰",,,
7,,"自主(音樂)
蔡維騰",,,
8,,,,,
,,,,,
"601
曾國誌",星期一,星期二,星期三,星期四,星期五
1,"體育
潘薇安","族群性別歷史
林孟儒","族群性別歷史
林孟儒","社會與經濟
歐姿儀","國語文
蔡千慧"
2,"歷史與文化
林孟儒","族群性別歷史
林孟儒","社會環境議題
謝依萍","未來與進路
劉庭瑜","體育
潘薇安"
3,"英語文
曾國誌","社會環境議題
謝依萍","數學乙
林恩宇","臺灣地理
謝依萍","共同選修
共選師1"
4,"社會與經濟
歐姿儀","英語文
曾國誌","英語文
曾國誌","臺灣地理
謝依萍","共同選修
共選師1"
5,"社會環境議題
謝依萍","國語文
蔡千慧","班會
曾國誌","國語文
蔡千慧","歷史與文化
林孟儒"
6,"共同選修
共選師1","數學乙
林恩宇","彈性學習
彈學師61","英語文
曾國誌","週會
曾國誌"
7,"共同選修
共選師1","社會與經濟
歐姿儀","彈性學習
彈學師61","數學乙
林恩宇","社團
社團師7"
8,,,,,
,,,,,
"602
謝依萍",星期一,星期二,星期三,星期四,星期五
1,"歷史與文化
林孟儒","社會與經濟
歐姿儀","社會環境議題
謝依萍","社會環境議題
謝依萍","體育
黃思綺"
2,"國語文
蔡千慧","國語文
蔡千慧","英語文
莊世爵","社會與經濟
歐姿儀","英語文
莊世爵"
3,"族群性別歷史
林孟儒","英語文
莊世爵","國語文
蔡千慧","族群性別歷史
林孟儒","共同選修
共選師2"
4,"英語文
莊世爵","數學乙
林恩宇","歷史與文化
林孟儒","族群性別歷史
林孟儒","共同選修
共選師2"
5,"數學乙
林恩宇","社會環境議題
謝依萍","班會
謝依萍","數學乙
林恩宇","社會與經濟
歐姿儀"
6,"共同選修
共選師2","體育
黃思綺","彈性學習
彈學師62","臺灣地理
謝依萍","週會
謝依萍"
7,"共同選修
共選師2","未來與進路
劉庭瑜","彈性學習
彈學師62","臺灣地理
謝依萍","社團
曾國誌"
8,,,,,
,,,,,
"603
游靜玟",星期一,星期二,星期三,星期四,星期五
1,"數學演習
吳銘川","英語文
莊世爵","化學
簡秀萍","物理
林文杰","數學甲
吳銘川"
2,"物理
林文杰","化學
簡秀萍",,"化學
簡秀萍","選修生物
李政學"
3,"選修生物
李政學","未來與進路
劉庭瑜","英語文
莊世爵","生物實驗
李政學","共同選修
共選師3"
4,"國語文
蔡千慧","體育
黃思綺","國語文
蔡千慧","生物實驗
李政學","共同選修
共選師3"
5,"數學甲
吳銘川","物理
林文杰","班會
游靜玟","英語文
莊世爵","國語文
蔡千慧"
6,"共同選修
共選師3","選修生物
李政學","彈性學習
彈學師63","數學演習
吳銘川","週會
游靜玟"
7,"共同選修
共選師3","數學甲
吳銘川","彈性學習
彈學師63","體育
黃思綺","社團
社團師5"
8,,,,,
,,,,,
"604
李孟達",星期一,星期二,星期三,星期四,星期五
1,"商業溝通
汪麗鈴","程式語言設計
李孟達
電腦教室1","會計學
汪麗鈴","體育
黃思綺","國語文
梁榕真"
2,"英語文
莊世爵","程式語言設計
李孟達
電腦教室1","商業禮儀
汪麗鈴","國語文
梁榕真","商用數學
連昱衡"
3,"商用數學
連昱衡","商業溝通
汪麗鈴","程式語言設計
李孟達
電腦教室1","英語文
莊世爵","共同選修
共選師4"
4,"國語文
梁榕真","英語文
莊世爵","程式語言設計
李孟達
電腦教室1","商用數學
連昱衡","共同選修
共選師4"
5,"會計學
汪麗鈴","會計軟體應用
汪麗鈴","班會
李孟達","數位科技應用
李孟達
電腦教室1","商業禮儀
汪麗鈴"
6,"共同選修
共選師4","會計軟體應用
汪麗鈴","彈性學習
彈學師64","數位科技應用
李孟達
電腦教室1","週會
李孟達"
7,"共同選修
共選師4","體育
黃思綺","彈性學習
彈學師64","未來與進路
劉庭瑜","社團
黃思綺"
8,,,,,
,,,,,
"605
高慧芳",星期一,星期二,星期三,星期四,星期五
1,"體育
黃思綺","中餐烹調實習
陳淑芬","飲料實務
邱歆喻","專題實作
余玥林","觀光餐旅管理
余玥林"
2,"觀餐英語會話
周正忠","中餐烹調實習
陳淑芬","飲料實務
邱歆喻","專題實作
余玥林","英語文
周正忠"
3,"餐旅服務技術
余玥林","中餐烹調實習
陳淑芬","國語文
梁榕真","商用數學
陳昭宏","共同選修
共選師5"
4,"餐旅服務技術
余玥林","中餐烹調實習
陳淑芬","英語文
周正忠","未來與進路
劉庭瑜","共同選修
共選師5"
5,"國語文
梁榕真","觀光餐旅管理
余玥林","班會
高慧芳","體育
黃思綺","商用數學
陳昭宏"
6,"共同選修
共選師5","英語文
周正忠","彈性學習
彈學師65","觀餐英語會話
周正忠","週會
高慧芳"
7,"共同選修
共選師5","商用數學
陳昭宏","彈性學習
彈學師65","國語文
梁榕真","社團
譚雅婷"
8,,,,,
,,,,,
"606
陳淑芬",星期一,星期二,星期三,星期四,星期五
1,"英語文
周正忠","中餐烹調實習
鐘坤賜
烹飪教室1","國語文
梁榕真","專題實作
邱歆喻","觀餐英語會話
周正忠"
2,"國語文
梁榕真","中餐烹調實習
鐘坤賜
烹飪教室1","觀光餐旅管理
余玥林","專題實作
邱歆喻","商用數學
陳昭宏"
3,"商用數學
陳昭宏","中餐烹調實習
鐘坤賜
烹飪教室1","英語文
周正忠","餐旅服務技術
余玥林","共同選修
共選師6"
4,"體育
黃思綺","中餐烹調實習
鐘坤賜
烹飪教室1","國語文
梁榕真","餐旅服務技術
余玥林","共同選修
共選師6"
5,"未來與進路
劉庭瑜","觀餐英語會話
周正忠","班會
陳淑芬","英語文
周正忠","體育
黃思綺"
6,"共同選修
共選師6","飲料實務
邱歆喻","彈性學習
彈學師66","商用數學
陳昭宏","週會
陳淑芬"
7,"共同選修
共選師6","飲料實務
邱歆喻","彈性學習
彈學師66","觀光餐旅管理
余玥林","社團
邱歆喻"
8,,,,,
,,,,,
621,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,"化學實驗
簡秀萍
化學實驗室1",,,,
7,"化學實驗
簡秀萍
化學實驗室1",,,,
8,,,,,
,,,,,
622,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,"日語
許亮昇",,,,
7,"日語
許亮昇",,,,
8,,,,,
,,,,,
623,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,"原住民樂舞
譚雅婷",,,,
7,"原住民樂舞
譚雅婷",,,,
8,,,,,
,,,,,
624,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,"百變蛋糕
陳淑芬",,,,
7,"百變蛋糕
陳淑芬",,,,
8,,,,,
,,,,,
625,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,"多媒體製應
李孟達
電腦教室1",,,,
7,"多媒體製應
李孟達
電腦教室1",,,,
8,,,,,
,,,,,
626,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,"手工餅乾
邱歆喻
烹飪教室1",,,,
7,"手工餅Ã
邱歆喻
烹飪教室1",,,,
8,,,,,
,,,,,
627,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,"趣味數學
連昱衡
智慧教室",,,,
7,"趣味數學
連昱衡
智慧教室",,,,
8,,,,,
,,,,,
628,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,"語文表達應用
蔡千慧",,,,
7,"語文表達應用
蔡千慧",,,,
8,,,,,
,,,,,
631,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,"Python_AI
李孟達
電腦教室1"
3,,,,,"Python_AI
李孟達
電腦教室1"
4,,,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
632,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,"原住民專題
黃曉慧"
4,,,,,"原住民專題
黃曉慧"
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
633,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,"歷史與時事
林孟儒"
4,,,,,"歷史與時事
林孟儒"
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
634,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,"韓語
游娟鐶"
4,,,,,"韓語
游娟鐶"
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
635,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,"百變蛋糕
陳淑芬"
4,,,,,"百變蛋糕
陳淑芬"
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
636,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,"音樂鑑賞
譚雅婷"
4,,,,,"音樂鑑賞
譚雅婷"
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
637,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,"統整數學
林恩宇"
4,,,,,"統整數學
林恩宇"
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
638,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,"企業管理
汪麗鈴"
4,,,,,"企業管理
汪麗鈴"
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
651,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,,"經濟學進階
李金龍",,
7,,,"經濟學進階
李金龍",,
8,,,,,
,,,,,
652,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,,"飲料調製技能
邱歆喻",,
7,,,"飲料調製技能
邱歆喻",,
8,,,,,
,,,,,
653,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,,"原住民音樂
譚雅婷",,
7,,,"原住民音樂
譚雅婷",,
8,,,,,
,,,,,
654,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,,"學測英文
莊世爵",,
7,,,"學測英文
莊世爵",,
8,,,,,
,,,,,
655,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,,"伴手禮研製
余玥林
烹飪教室1",,
7,,,"伴手禮研製
余玥林
烹飪教室1",,
8,,,,,
,,,,,
656,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,,"統測國文
梁榕真",,
7,,,"統測國文
梁榕真",,
8,,,,,
,,,,,
657,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,,"自主(學科)
陳靜誼",,
7,,,"自主(學科)
陳靜誼",,
8,,,,,
,,,,,
658,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,,"自主(語文)
蔡千慧",,
7,,,"自主(語文)
蔡千慧",,
8,,,,,
,,,,,
659,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,,"自主(音樂)
蔡維騰",,
7,,,"自主(音樂)
蔡維騰",,
8,,,,,
,,,,,
a405,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,"本土語(2)
李清波",
6,,,,,
7,,,,,
8,,,,,
,,,,,
a506,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,"專題實作
李政學",,,,
6,"專題實作
李政學",,,,
7,"專題實作
李政學",,,,
8,,,,,
,,,,,
b506,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,"專題實作
蔡維騰",,,,
6,"專題實作
蔡維騰",,,,
7,"專題實作
蔡維騰",,,,
8,,,,,
,,,,,
e301,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,,,,
7,,,,,"補救教學
蘇家逸"
8,,,,,
,,,,,
h104,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,"臺手語(本)
郭仲怡
智慧教室",,,
4,,,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
h201,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,"臺手語(本)
郭仲怡
智慧教室",
3,,,,,
4,,,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
h202,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,"臺手語(本)
郭仲怡
智慧教室",
4,,,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
h403,星期一,星期二,星期三,星期四,星期五
1,,,,,"臺手語(本)
李清波"
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
h404,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,"臺手語(本)
李清波"
3,,,,,
4,,,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
1405,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,"本土語(3)
蔡維騰",
6,,,,,
7,,,,,
8,,,,,
,,,,,
n103,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,"客家語(本)
何新梅",,
3,,,,,
4,,,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
n201,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,"客家語(本)
何新梅",
3,,,,,
4,,,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
n202,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,"客家語(本)
何新梅",
4,,,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
n203,星期一,星期二,星期三,星期四,星期五
1,,,,,"客家語(本)
何新梅"
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
n204,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,"客家語(本)
何新梅",,,
3,,,,,
4,,,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
n401,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,"客家語(本)
何新梅",
6,,,,,
7,,,,,
8,,,,,
,,,,,
t201,星期一,星期二,星期三,星期四,星期五
1,,,"動動金手指
鄭雅茵",,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
t202,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,"動動金手指
鄭雅茵"
4,,,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
t203,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,"動動金手指
鄭雅茵"
3,,,,,
4,,,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
t204,星期一,星期二,星期三,星期四,星期五
1,,,,,"動動金手指
王皓正"
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
t405,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,"原住民樂舞
懷劭法努司",,,,
3,,,,,
4,,,,,
5,"原住民樂舞
懷劭法努司",,,"本土語(1)
簡秀萍",
6,,,,,
7,,,,,
8,,,,,
,,,,,
t504,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,"專題實作
王怡文",
6,,,,"專題實作
王怡文",
7,,,,,
8,,,,,
,,,,,
t505,星期一,星期二,星期三,星期四,星期五
1,,"專題實作
王怡文",,,
2,,"專題實作
王怡文",,,
3,,,,,
4,,,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
t522,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,"原住民樂舞
懷劭法努司",,,,
4,"原住民樂舞
懷劭法努司",,,,
5,,,,,
6,,,,,
7,,,,,
8,,,,,
,,,,,
t623,星期一,星期二,星期三,星期四,星期五
1,,,,,
2,,,,,
3,,,,,
4,,,,,
5,,,,,
6,"原住民樂舞
懷劭法努司",,,,
7,"原住民樂舞
懷劭法努司",,,,
8,,,,,
`;

// --- ▼▼▼ 請將這整段資料貼在 csvStaffDirectory 的前面 ▼▼▼ ---
    const csvSubjectData = `國文,張耕翰,專任教師
國文,游麗萍,104導師
國文,陳映伶,303導師
國文,黃耀慧,102導師
國文,何新梅,專任教師
國文,許雅玲,試務組長
國文,劉芝妤,202導師
國文,陳映如,總務主任
國文,范麗萍,專任教師
國文,許亮昇,405導師
國文,李佳樺,503導師
國文,蔡千慧,406導師
國文,梁榕真,協助行政
國文,張嘉雯,協助行政
英文,方淑貞,103導師
英文,黃政榕,302導師
英文,高晉強,教務主任
英文,江紹瑄,協助行政
英文,曾翔蔚,兼任教師
英文,許仲璦,兼任教師
英文,曾國誌,601導師
英文,張淑粉,輔導組長
英文,謝佳琪,505導師
英文,陳毓珍,採編組長
英文,莊世爵,專任教師
英文,周正忠,專任教師
英文,游娟鐶,兼任教師
英文,外籍教師,專任教師
數學,蘇威光,201導師
數學,蔡佳樺,204導師
數學,王莉婷,衛生組長
數學,林宏譯,生輔組長
數學,陳銘漢,兼任教師
數學,吳銘川,501導師
數學,林恩宇,502導師
數學,張惟智,402導師
數學,游靜玟,603導師
數學,陳昭宏,401導師
數學,連昱衡,資訊組長
社會,林嘉慧,訓育組長
社會,徐紹青,體育組長
社會,方瑋樺,304導師
社會,郭仲怡,教學組長
社會,黃曉慧,圖書主任
社會,謝依萍,602導師
社會,陳靜誼,504導師
社會,王怡文,404導師
社會,歐姿儀,讀服組長
社會,林孟儒,專任教師
科技,吳建璿,科技主任
科技,蔣銘宗,專任教師
自然,高建國,專任教師
自然,王皓正,學務主任
自然,鄭雅茵,生發組長
自然,李承修,專任教師
自然,黃婉婷,兼任教師
自然,簡秀萍,實研組長
自然,林文杰,506導師
自然,李政學,活動組長
自然,蔡維騰,設備組長
自然,蘇家逸,兼任教師
自然,自然師1,兼任教師
自然,自然師2,兼任教師
健體,鍾育倫,專任教師
健體,陳毅芬,301導師
健體,潘薇安,專任教師
健體,高慧芳,605導師
健體,周桂英,專任教師
健體,黃思綺,協助行政
健體,傅君然,衝浪社
健體,吳裕隆,籃球社
綜合,黃美玲,協助行政
綜合,李清波,註冊組長
綜合,龔偉遜,專任教師
綜合,劉庭瑜,專任教師
商管,李金龍,輔導主任
商管,李孟達,604導師
商管,洪華欣,專任教師
商管,汪麗鈴,專任教師
商管,龔進庭,專任教師
商管,余玥林,403導師
商管,陳淑芬,606導師
商管,邱歆喻,協助行政
商管,鐘坤賜,兼任教師
商管,潘翌展,兼任教師
藝術,陳信全,101導師
藝術,洪婉郡,203導師
藝術,譚雅婷,協助行政
藝術,張詩佳,專任教師
藝術,懷劭法努司,兼任教師
藝術,黃瑋瑤,兼任教師
藝術,蔡芸琤,兼任教師
其他,簡富源,國防教官
其他,吳嬋娜,社團
`;
    // --- ▲▲▲ 新增資料結束 ▲▲▲ ---


    // --- 修正後的資料區 ---
    const csvStaffDirectory = `處室,單位,職稱,姓名,分機
校長室,,校長,陳玉桂,100
教務處,,教務主任,高晉強,200
教務處,教學組,教學組長,郭仲怡,210
教務處,教學組,教學組幹事,簡文信,211
教務處,註冊組,註冊組長,李清波,220
教務處,註冊組,註冊組幹事,趙家琪,221
教務處,設備組,設備組長,蔡維騰,230
教務處,實研組,實驗研究組長,簡秀萍,240
教務處,試務組,試務組長,許雅玲,250
教務處,組織再造,組織再造,郭美雲,202
教務處,協助行政,協助行政,邱歆喻,202
教務處,協助行政,協助行政,江紹瑄,202
教務處,充實行政人員,充實行政人員,林韋伶,202
教務處,專案助理,專案助理,張珈綺,201
教務處,專案助理,專案助理,王貞緒,201
教務處,專案助理,專案助理,洪明芸,201
學務處,,學務主任,王皓正,300
學務處,訓育組,訓育組長,林嘉慧,310
學務處,生輔組,生活教育組長,林宏譯,320
學務處,體衛組,體育運動組長,徐紹青,330
學務處,社團組,社團活動組長,李政學,340
學務處,衛生組,衛生保健組長,王莉婷,350
學務處,童軍團,童軍團團長,龔偉遜,350
學務處,校安,校安人員,林嵑墩,320
學務處,協助行政,協助行政,黃思綺,310
學務處,協助行政,協助行政,簡富源,350
學務處,助理員,助理員,劉思汝,350
學務處,教官,教官,,350
學務處,宿舍輔導員,宿舍輔導員,連雅惠,350
學務處,宿舍輔導員,宿舍輔導員,陳美蘭,321
學務處,管理員,管理員,蔡佳欣,321
總務處,,總務主任,陳映如,400
總務處,事務組,事務組長,蔡明貴,410
總務處,文書組,文書組長,黃尹泰,430
總務處,出納組,出納組長,李耿豪,420
總務處,幹事,幹事,鍾淑貞,410
總務處,營養師,營養師,劉庭妤,411
總務處,警衛,警衛,許焰煌,414
總務處,警衛,警衛,葉健忠,
總務處,助理,助理,王冠策,413
總務處,組織再造,組織再造,周家德,430
總務處,助理,助理,佘桂蓮,420
總務處,助理,助理,王貞緒,410
輔導處,,輔導主任,李金龍,500
輔導處,輔導組,輔導組長,張淑粉,510
輔導處,生涯組,生涯發展組長,鄭雅茵,520
輔導處,特教組,特教組長,吳泯馨,530
輔導處,專輔,專任輔導教師,陳俐彣,512
輔導處,巡迴教師,特教教師(巡迴),白欣雅,530
輔導處,特教班導師,特教班導師,,531
輔導處,特教班專任,特教班專任教師,張榕芸,532
輔導處,資源班導師,資源班導師,王鈺如,533
輔導處,特教班導師,特教班導師,龔進庭,531
輔導處,特教班專任,特教班專任教師,蔡尹綺,532
輔導處,特教助理員,特教助理員,許淑霞,532
輔導處,社工師,社工師,高韶霙,511
高輔中心,,專任輔導教師,賴雅琦,513
高輔中心,,專任輔導教師,簡潔妮,514
高輔中心,,協助行政,張嘉雯,514
高輔中心,,專任教師,,514
高輔中心,,專任教師,劉庭瑜,514
高輔中心,,特教教師,廖婉雯,514
圖書館,,圖書館主任,黃曉慧,600
圖書館,,採編組長,陳毓珍,620
圖書館,,讀者服務組長,歐姿儀,630
圖書館,,資訊媒體組長,連昱衡,610
圖書館,,協助行政,譚雅婷,620
健康中心,,護理師,張琪敏,351
體育辦公室,,體育教師,潘薇安,331
人事室,,人事主任,林佳萍,700
人事室,,人事組員,潘曼菁,701
會計室,,會計主任,卓惠苓,710
會計室,,會計佐理員,黃啟祐,713
國一導,,101導師,陳信全,921
國一導,,102導師,黃耀慧,922
國一導,,103導師,方淑貞,922
國一導,,104導師,游麗萍,922
國二導,,201導師,蘇威光,911
國二導,,202導師,劉芝妤,911
國二導,,203導師,洪婉郡,912
國二導,,204導師,蔡佳樺,912
國三導,,301導師,陳毅芬,931
國三導,,302導師,黃政榕,932
國三導,,303導師,陳映伶,933
國三導,,304導師,方瑋樺,931
國專,,專任教師,鍾育倫,971
國專,,專任教師,何新梅,971
國專,,專任教師,張耕翰,972
國專,,專任教師,黃美玲,972
國專,,專任教師,李承修,971
國專,,專任教師,高建國,971
國專,,專任教師,蔣銘宗,972
國專,,專任教師,張詩佳,971
國專,,兼任教師,陳銘漢,971
國專,,兼任教師,曾翔蔚,972
科技中心,,科技中心主任,吳建璿,121
科技中心,,科技中心組長,梁榕真,122
科技中心,,專案助理,郭瑜欣,123
科技中心,,協助行政,郭瑜欣,122
,,教師會,,901
,,禮堂(音控室),,902
,,主機房,,611
高中辦公室,,401導師,陳昭宏,944
高中辦公室,,402導師,張惟智,946
高中辦公室,,403導師,余玥林,944
高中辦公室,,404導師,王怡文,941
高中辦公室,,405導師,許亮昇,942
高中辦公室,,406導師,蔡千慧,945
高中辦公室,,501導師,吳銘川,942
高中辦公室,,502導師,林恩宇,946
高中辦公室,,503導師,李佳樺,943
高中辦公室,,504導師,陳靜誼,943
高中辦公室,,505導師,謝佳琪,945
高中辦公室,,506導師,林文杰,942
高中辦公室,,601導師,曾國誌,943
高中辦公室,,602導師,謝依萍,946
高中辦公室,,603導師,游靜玟,944
高中辦公室,,604導師,李孟達,945
高中辦公室,,605導師,高慧芳,941
高中辦公室,,606導師,陳淑芬,941
高中,,專任教師,洪華欣,942
高中,,專任教師,范麗萍,944
高中,,專任教師,汪麗鈴,941
高中,,專任教師,莊世爵,945
高中,,專任教師,周桂英,946
高中,,專任教師,周正忠,943
其他,,許仲璦,
其他,,游娟鐶,
其他,,外籍教師,
其他,,林孟儒,
其他,,黃婉婷,
其他,,蘇家逸,
其他,,鐘坤賜,
其他,,潘翌展,
其他,,懷劭法努司,
其他,,黃瑋瑤,
其他,,蔡芸琤,
其他,,傅君然,
其他,,吳裕隆,
其他,,吳嬋娜,
`;

    // --- 4. DATA PROCESSING & DISPLAY ---
    const classSchedules = new Map();
    const teacherSchedules = new Map();
    const locationSchedules = new Map();
    const teacherExtensions = new Map();
    let teacherViewSelectedCell = null;
    let classViewSelectedCell = null;
    let currentView = 'department';
    let longPressTimer;
    const LONG_PRESS_DURATION = 500;

    function parseFullCsv(csvString) {
        const rows = [];
        let currentRow = [];
        let currentField = '';
        let inQuotes = false;
        const normalizedCsv = csvString.replace(/\r/g, '');

        for (let i = 0; i < normalizedCsv.length; i++) {
            const char = normalizedCsv[i];
            const nextChar = normalizedCsv[i + 1];

            if (char === '"' && inQuotes && nextChar === '"') {
                currentField += '"';
                i++;
            } else if (char === '"') {
                inQuotes = !inQuotes;
            } else if (char === ',' && !inQuotes) {
                currentRow.push(currentField);
                currentField = '';
            } else if (char === '\n' && !inQuotes) {
                currentRow.push(currentField);
                if (currentRow.length > 1 || currentRow[0]) {
                    rows.push(currentRow);
                }
                currentRow = [];
                currentField = '';
            } else {
                currentField += char;
            }
        }
        currentRow.push(currentField);
        if (currentRow.length > 0 && currentRow.some(field => field.trim())) {
            rows.push(currentRow);
        }
        return rows.map(row => row.map(field => field.trim()));
    }

    function parseClassSchedules(allTeachers) {
        const rows = parseFullCsv(csvClassSchedule);
        const classHeaderRegex = /^\d{3}/;

        const tempClassData = new Map();
        let currentClassInfo = null;
        let scheduleRowsForCurrentClass = [];

        for(const row of rows) {
            if (row.length > 0 && classHeaderRegex.test(row[0])) {
                if (currentClassInfo) {
                    tempClassData.set(currentClassInfo.className, { info: currentClassInfo, scheduleRows: scheduleRowsForCurrentClass });
                }
                const parts = row[0].split('\n').map(p => p.trim());
                currentClassInfo = { className: parts[0], homeroomTeacher: parts[1] };
                scheduleRowsForCurrentClass = [];
            } else if (currentClassInfo && /^[1-8]$/.test(row[0])) {
                scheduleRowsForCurrentClass.push(row);
            }
        }
        if (currentClassInfo) {
            tempClassData.set(currentClassInfo.className, { info: currentClassInfo, scheduleRows: scheduleRowsForCurrentClass });
        }

        for(const [className, data] of tempClassData.entries()) {
            if (data.info.homeroomTeacher && isValidTeacher(data.info.homeroomTeacher)) {
                allTeachers.add(data.info.homeroomTeacher);
            }
            const scheduleGrid = Array.from({ length: 8 }, () => Array(5).fill(null));
            for(const scheduleRow of data.scheduleRows) {
                const period = parseInt(scheduleRow[0], 10) - 1;
                for (let day = 0; day < 5; day++) {
                    const cellContent = scheduleRow[day + 1] || "";
                    const contentParts = cellContent.split('\n').map(p => p.trim());
                    if (contentParts.length > 1 && contentParts[0]) {
                        scheduleGrid[period][day] = {
                            subject: contentParts[0] || '',
                            teacher: contentParts[1] || '',
                            location: contentParts.slice(2).join(' ') || ''
                        };
                    }
                }
            }
            classSchedules.set(className, scheduleGrid);
        }
    }

    function deriveSchedules() {
        const allTeachers = new Set();
        parseClassSchedules(allTeachers);

        for (const [className, grid] of classSchedules.entries()) {
            for (let period = 0; period < grid.length; period++) {
                for (let day = 0; day < grid[period].length; day++) {
                    const cellData = grid[period][day];
                    if (cellData) {
                        if (cellData.teacher && isValidTeacher(cellData.teacher)) {
                            const teacher = cellData.teacher;
                            allTeachers.add(teacher);
                            if (!teacherSchedules.has(teacher)) {
                                teacherSchedules.set(teacher, Array.from({ length: 8 }, () => Array(5).fill(null)));
                            }
                            const teacherGrid = teacherSchedules.get(teacher);
                            if (teacherGrid[period][day] === null) {
                               teacherGrid[period][day] = {
                                    subject: cellData.subject,
                                    class: className,
                                    location: cellData.location,
                                    period: period
                               };
                            }
                        }
                        if (cellData.location) {
                            const location = cellData.location;
                            if (!locationSchedules.has(location)) {
                                locationSchedules.set(location, Array.from({ length: 8 }, () => Array(5).fill(null)));
                            }
                            const locationGrid = locationSchedules.get(location);
                            locationGrid[period][day] = {
                                subject: cellData.subject,
                                class: className,
                                teacher: cellData.teacher
                            };
                        }
                    }
                }
            }
        }
        return allTeachers;
    }

    function isValidTeacher(name) {
        if (!name) return false;
        return !/^(英文師|數學師|自然師|共選師|社團師|彈學師)\d*$/.test(name);
    }

    function isValidClassForListing(name) {
        if (!name) return false;
        if (!/^\d{3}$/.test(name)) return false;
        const lastTwoDigits = parseInt(name.substring(1), 10);
        return lastTwoDigits <= 9;
    }

    function parseStaffDirectoryForDisplay() {
        const lines = parseFullCsv(csvStaffDirectory);
        const structureMap = new Map();
        const staffSet = new Set();

        for (let i = 1; i < lines.length; i++) {
            const row = lines[i];
            if (row.length < 4) continue;

            const office = row[0].trim();
            const title = row[2].trim();
            const name = row[3].trim();
            const ext = row[4] ? row[4].trim() : '';

            if (name && office) {
                 if (!structureMap.has(office)) {
                    structureMap.set(office, { office: office, members: [] });
                }
                const section = structureMap.get(office);
                section.members.push({ title: title, name: name, ext: ext });
                staffSet.add(name);
                if (ext) { teacherExtensions.set(name, ext); }
            }
        }

        const structure = Array.from(structureMap.values());
        return { structure, staffSet };
    }

    function populateTeacherList(allTeachersWithSchedule) {
        const container = document.getElementById('teacher-list-container');
        container.innerHTML = '';

        const { structure, staffSet } = parseStaffDirectoryForDisplay();

        const filteredStructure = [];
        structure.forEach(dept => {
            const scheduledMembers = dept.members.filter(member => allTeachersWithSchedule.has(member.name));
            if (scheduledMembers.length > 0) {
                filteredStructure.push({ office: dept.office, members: scheduledMembers });
            }
        });

        let otherSection = filteredStructure.find(s => s.office === '其他');
        if (otherSection) {
            otherSection.office = "專任教師";
        }

        const unlistedTeachers = [...allTeachersWithSchedule]
            .filter(name => isValidTeacher(name) && !staffSet.has(name));

        let teacherSection = filteredStructure.find(s => s.office === '專任教師');
        if (!teacherSection && unlistedTeachers.length > 0) {
            teacherSection = { office: '專任教師', members: [] };
            filteredStructure.push(teacherSection);
        }
        if (teacherSection && unlistedTeachers.length > 0) {
             unlistedTeachers.forEach(name => {
                if (!teacherSection.members.some(m => m.name === name)) {
                    teacherSection.members.push({ title: '專任教師', name: name, ext: '' });
                }
            });
        }

        const departmentOrder = ["校長室", "教務處", "學務處", "總務處", "輔導處", "圖書館", "國一導", "國二導", "國三導", "國專", "高中辦公室", "高中", "健康中心", "體育辦公室", "人事室", "會計室", "高輔中心", "科技中心"];
        let orderedStructure = departmentOrder
            .map(officeName => filteredStructure.find(s => s.office === officeName))
            .filter(Boolean);

        const specialSection = filteredStructure.find(s => s.office === '專任教師');

        const totalEntries = orderedStructure.reduce((sum, dept) => sum + dept.members.length, 0);
        const numColumns = 5;
        const targetHeight = totalEntries / numColumns;

        const columnGroups = [];
        let currentGroup = [];
        let currentHeight = 0;

        orderedStructure.forEach(dept => {
            if (currentGroup.length > 0 && currentHeight + (dept.members.length / 2) > targetHeight && columnGroups.length < numColumns - 1) {
                columnGroups.push(currentGroup);
                currentGroup = [];
                currentHeight = 0;
            }
            currentGroup.push(dept);
            currentHeight += dept.members.length;
        });
        if (currentGroup.length > 0) {
            columnGroups.push(currentGroup);
        }
        if (specialSection) {
            columnGroups.push([specialSection]);
        }

        columnGroups.forEach(group => {
            const columnDiv = document.createElement('div');
            columnDiv.className = 'teacher-display-column';

            group.forEach(dept => {
                const table = document.createElement('table');
                table.className = 'department-table';

                const thead = table.createTHead();
                const headerRow = thead.insertRow();
                const th = document.createElement('th');
                th.colSpan = 3;
                th.textContent = dept.office;
                headerRow.appendChild(th);

                const tbody = table.createTBody();
                dept.members.forEach(member => {
                    const row = tbody.insertRow();
                    row.insertCell().textContent = member.title;
                    const nameCell = row.insertCell();
                    nameCell.className = 'name-cell';
                    nameCell.textContent = member.name;
                    nameCell.onclick = () => showSchedule('teacher', member.name);
                    row.insertCell().textContent = member.ext;
                });
                columnDiv.appendChild(table);
            });
            container.appendChild(columnDiv);
        });
    }

    function populateClassList() {
        const selector = document.getElementById('class-selector');
        const classesForList = [...classSchedules.keys()].filter(isValidClassForListing).sort();

        classesForList.forEach(name => {
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            selector.appendChild(option);
        });

        selector.onchange = function() {
            if (this.value) {
                document.getElementById('location-selector').value = "";
                showSchedule('class', this.value);
            }
        };
    }

    function populateLocationList() {
        const selector = document.getElementById('location-selector');
        const locations = [...locationSchedules.keys()].sort();

        locations.forEach(name => {
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            selector.appendChild(option);
        });
        
        selector.onchange = function() {
            if(this.value) {
                document.getElementById('class-selector').value = "";
                showSchedule('location', this.value);
            }
        };
    }

    function populateTeacherListBySubject(allTeachersWithSchedule) {
        const container = document.getElementById('teacher-list-by-subject-container');
        container.innerHTML = '';

        const subjectMap = new Map();
        const rows = csvSubjectData.trim().split('\n').map(row => row.split(','));

        rows.forEach(row => {
            if (row.length >= 2) {
                const subject = row[0].trim();
                const name = row[1].trim();
                let role = row[2]?.trim() || '專任';

                if (!allTeachersWithSchedule.has(name)) return;
                if (!subjectMap.has(subject)) {
                    subjectMap.set(subject, []);
                }
                subjectMap.get(subject).push({ name, role });
            }
        });

        [...subjectMap.keys()].forEach(subject => {
            const table = document.createElement('table');
            table.className = 'department-table';
            const thead = table.createTHead();
            const headerRow = thead.insertRow();
            const th = document.createElement('th');
            th.colSpan = 3;
            th.textContent = subject;
            headerRow.appendChild(th);

            const tbody = table.createTBody();
            subjectMap.get(subject).forEach(member => {
                const row = tbody.insertRow();
                row.insertCell().textContent = member.role;
                const nameCell = row.insertCell();
                nameCell.className = 'name-cell';
                nameCell.textContent = member.name;
                nameCell.onclick = () => showSchedule('teacher', member.name);
                row.insertCell().textContent = teacherExtensions.get(member.name) || '';
            });
            container.appendChild(table);
        });
    }

    function showSchedule(type, name) {
        localStorage.setItem('lastSchedule', JSON.stringify({ view: currentView, type: type, name: name }));
     	const modal = document.getElementById('schedule-modal');
        const titleEl = document.getElementById('modal-title');
        const titleEl2 = document.getElementById('modal-title2');
        const bodyEl = document.getElementById('modal-body');
        const reminderContainer = document.getElementById('reminder-container');
        let schedule, title;

        reminderContainer.innerHTML = '';

        if (type === 'teacher' && teacherSchedules.has(name)) {
            schedule = teacherSchedules.get(name);
            title = `${name} 課表`;
			const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
            const interactionHint = isTouchDevice ? '長按' : '右鍵';
            titleEl2.textContent = `＊點擊格子看調課選擇，${interactionHint}可加入行事曆註記＊`;			
        } else if (type === 'class' && classSchedules.has(name)) {
            schedule = classSchedules.get(name);
            title = `${name} 班課表`;
            titleEl2.textContent = '＊點擊有課的格子可看換課選擇＊';
        } else if (type === 'location' && locationSchedules.has(name)) {
            schedule = locationSchedules.get(name);
            title = `${name} 場地課表`;
            titleEl2.textContent = '';
        } else {
            bodyEl.innerHTML = `<p style="text-align:center;">找不到 ${name} 的課表資料。</p>`;
            titleEl.textContent = "資料錯誤";
            modal.style.display = 'block';
            return;
        }

        titleEl.textContent = title;
        const days = ['星期一', '星期二', '星期三', '星期四', '星期五'];
        let tableHtml = '<table class="schedule-table"><thead><tr><th>節次</th>';
        days.forEach(day => tableHtml += `<th>${day}</th>`);
        tableHtml += '</tr></thead><tbody>';

        for (let period = 0; period < 8; period++) {
            tableHtml += `<tr><td class="period-header">${period + 1}</td>`;
            for (let day = 0; day < 5; day++) {
                const cellData = schedule[period]?.[day];
                let content = '';
                if (cellData) {
                    if (type === 'teacher') content = `<span class="subject">${cellData.subject || ''}</span><span class="details">${cellData.class || ''}</span><span class="details">${cellData.location || ''}</span>`;
                    else if (type === 'class') content = `<span class="subject">${cellData.subject || ''}</span><span class="details">${cellData.teacher || ''}</span><span class="details">${cellData.location || ''}</span>`;
                    else if (type === 'location') content = `<span class="subject">${cellData.subject || ''}</span><span class="details">${cellData.class || ''}</span><span class="details">${cellData.teacher || ''}</span>`;
                    tableHtml += `<td data-period="${period}" data-day="${day}">${content}</td>`;
                } else {
                    tableHtml += `<td class="empty-cell" data-period="${period}" data-day="${day}"></td>`;
                }
            }
            tableHtml += '</tr>';
        }
        tableHtml += '</tbody></table>';
        bodyEl.innerHTML = tableHtml;

        const scheduleTable = bodyEl.querySelector('.schedule-table');
        if (type === 'teacher') {
            teacherViewSelectedCell = null;
            scheduleTable.addEventListener('click', (e) => handleTeacherCellClick(e, name));
            scheduleTable.addEventListener('contextmenu', (e) => handleTeacherCellInteraction(e, name));
            scheduleTable.addEventListener('touchstart', (e) => handleTeacherCellInteraction(e, name), { passive: true });
            scheduleTable.addEventListener('touchend', () => clearTimeout(longPressTimer));
            scheduleTable.addEventListener('touchmove', () => clearTimeout(longPressTimer));
        } else if (type === 'class') {
            classViewSelectedCell = null;
            scheduleTable.addEventListener('click', (e) => handleClassCellClick(e, name));
        }
        modal.style.display = 'block';
    }

	function handleTeacherCellClick(event, teacherName) {
        const cell = event.target.closest('td');
        if (!cell || cell.classList.contains('period-header')) return;
        const table = cell.closest('table');

        const clearAllSelections = () => {
            table.querySelectorAll('.highlight, .swap-suggestion').forEach(el => {
                el.classList.remove('highlight', 'swap-suggestion');
                // [修正] 恢復儲存的原始內容後，就刪除暫存資料，避免汙染
                if (el.dataset.originalText !== undefined) {
                    el.innerHTML = el.dataset.originalText;
                    delete el.dataset.originalText;
                }
            });
            teacherViewSelectedCell = null;
        };

        // [修正] 正確呼叫 clearAllSelections 函式，並結束後續操作
        if (cell === teacherViewSelectedCell) {
            clearAllSelections();
            return;
        }

        clearAllSelections();

        const originalPeriod = parseInt(cell.dataset.period);
        const originalDay = parseInt(cell.dataset.day);
        const ownSchedule = teacherSchedules.get(teacherName);
        const clickedLesson = ownSchedule[originalPeriod]?.[originalDay];
        
        // [修正] 將 !clickedLesson 的判斷提前，確保點擊空格時能正確清除並返回
        if (!clickedLesson) {
            return;
        }
        if (originalPeriod >= 7 || (originalDay === 4 && originalPeriod >= 5)) return;

        cell.classList.add('highlight');
        teacherViewSelectedCell = cell;
        const classSchedule = classSchedules.get(clickedLesson.class);
        if (!classSchedule) return;

        for (let p = 0; p < 7; p++) {
            for (let d = 0; d < 5; d++) {
                if (d === 4 && p >= 5) continue;
                if (!ownSchedule[p]?.[d]) {
                    const lessonAtTarget = classSchedule[p]?.[d];
                    if (lessonAtTarget?.teacher && lessonAtTarget.teacher !== teacherName) {
                        const otherTeacherSchedule = teacherSchedules.get(lessonAtTarget.teacher);
                        if (otherTeacherSchedule && !otherTeacherSchedule[originalPeriod]?.[originalDay]) {
                            const targetCell = table.querySelector(`td[data-period="${p}"][data-day="${d}"]`);
                            if (targetCell) {
                                targetCell.classList.add('swap-suggestion');
                                targetCell.dataset.originalText = targetCell.innerHTML;
                                const ext = teacherExtensions.get(lessonAtTarget.teacher);
                                const extHtml = ext ? `<span class="ext-details">(分機 ${ext})</span>` : '';
                                targetCell.innerHTML = `<span class="subject">${lessonAtTarget.subject}</span><span class="class-details">${clickedLesson.class}</span><span class="teacher-details">${lessonAtTarget.teacher}</span>${extHtml}`;
                            }
                        }
                    }
                }
            }
        }
    }
	
    function handleClassCellClick(event, className) {
        const cell = event.target.closest('td');
        if (!cell || cell.classList.contains('period-header')) {
            if (classViewSelectedCell) showSchedule('class', className);
            return;
        }
        if (cell === classViewSelectedCell || cell.classList.contains('empty-cell') || cell.classList.contains('cleared-cell')) {
            showSchedule('class', className);
            return;
        }

        showSchedule('class', className);
        const freshTable = document.getElementById('modal-body').querySelector('table');
        const freshCell = freshTable.querySelector(`td[data-period="${cell.dataset.period}"][data-day="${cell.dataset.day}"]`);
        classViewSelectedCell = freshCell;
        freshCell.classList.add('highlight');

        const originalPeriod = parseInt(freshCell.dataset.period);
        const originalDay = parseInt(freshCell.dataset.day);
        const classSchedule = classSchedules.get(className);
        const clickedLesson = classSchedule[originalPeriod]?.[originalDay];

        if (!clickedLesson?.teacher || originalPeriod >= 7 || (originalDay === 4 && originalPeriod >= 5)) return;

        freshTable.querySelectorAll('tbody td:not(.period-header)').forEach(td => {
            if (td !== freshCell) {
                td.innerHTML = '';
                td.classList.add('cleared-cell', 'empty-cell');
            }
        });

        const teacherASchedule = teacherSchedules.get(clickedLesson.teacher);
        if (!teacherASchedule) return;

        for (let p = 0; p < 7; p++) {
            for (let d = 0; d < 5; d++) {
                if ((p === originalPeriod && d === originalDay) || (d === 4 && p >= 5)) continue;
                const lessonAtTarget = classSchedule[p]?.[d];
                if (lessonAtTarget?.teacher && lessonAtTarget.teacher !== clickedLesson.teacher) {
                    const teacherBSchedule = teacherSchedules.get(lessonAtTarget.teacher);
                    if (teacherBSchedule && !teacherASchedule[p]?.[d] && !teacherBSchedule[originalPeriod]?.[originalDay]) {
                        const targetCell = freshTable.querySelector(`td[data-period="${p}"][data-day="${d}"]`);
                        if (targetCell) {
                            targetCell.classList.remove('cleared-cell', 'empty-cell');
                            targetCell.classList.add('swap-suggestion');
                            const ext = teacherExtensions.get(lessonAtTarget.teacher);
                            const extHtml = ext ? `<span class="ext-details">(分機 ${ext})</span>` : '';
                            targetCell.innerHTML = `<span class="subject">${lessonAtTarget.subject}</span><span class="class-details">${className}</span><span class="teacher-details">${lessonAtTarget.teacher}</span>${extHtml}`;
                        }
                    }
                }
            }
        }
    }

    function handleTeacherCellInteraction(event, teacherName) {
        const cell = event.target.closest('td');
        if (!cell || cell.classList.contains('empty-cell') || cell.classList.contains('period-header')) return;

        const period = parseInt(cell.dataset.period);
        const day = parseInt(cell.dataset.day);
        const lesson = teacherSchedules.get(teacherName)?.[period]?.[day];
        if (!lesson) return;
        
        const showModal = () => showSingleEventModal(lesson, day, teacherName);

        if (event.type === 'contextmenu') {
            event.preventDefault();
            showModal();
        } else if (event.type === 'touchstart') {
            clearTimeout(longPressTimer);
            longPressTimer = setTimeout(showModal, LONG_PRESS_DURATION);
        }
    }

    function showSingleEventModal(lesson, dayIndex, teacherName) {
        const modal = document.getElementById('single-event-modal');
        const infoEl = document.getElementById('single-event-info');
        const dateInput = document.getElementById('single-event-date');
        const notesInput = document.getElementById('event-notes');
        const downloadBtn = document.getElementById('download-single-ics-btn');

        const days = ['星期一', '星期二', '星期三', '星期四', '星期五'];
        infoEl.innerHTML = `${days[dayIndex]} 第 ${lesson.period + 1} 節<br><strong>${lesson.subject} (${lesson.class})</strong>`;
        
        notesInput.value = ''; // 清空上次的註記

        const today = new Date();
        const currentDayOfWeek = today.getDay();
        const targetDayOfWeek = dayIndex + 1;
        const dayDifference = targetDayOfWeek - (currentDayOfWeek === 0 ? 7 : currentDayOfWeek);
        
        const targetDate = new Date(today);
        targetDate.setDate(today.getDate() + dayDifference);
        dateInput.value = targetDate.toISOString().split('T')[0];
        
        downloadBtn.onclick = () => {
            const options = {
                teacherName,
                date: dateInput.value,
                notes: notesInput.value
            };
            generateIcsForLesson(lesson, options);
            modal.style.display = 'none';
        };
        modal.style.display = 'block';
    }

    function generateIcsForLesson(lesson, options) {
        const { teacherName, date, notes } = options;
        
        const [startH, startM] = classStartTimes[lesson.period + 1].split(':');
        const startTime = new Date(date);
        startTime.setHours(startH, startM, 0, 0);
        const endTime = new Date(startTime.getTime() + 50 * 60000);

        const formatTime = (d) => d.toISOString().replace(/[-:.]/g, '').slice(0, 15) + 'Z';
        
        // 將換行符號轉換為 ICS 格式接受的 \\n
        const formattedNotes = notes.replace(/\n/g, '\\n');

        let eventDetails = [
            'BEGIN:VEVENT',
            `UID:${startTime.getTime()}-${lesson.subject}@myapp.com`,
            `DTSTAMP:${formatTime(new Date())}`,
            `DTSTART;TZID=Asia/Taipei:${formatTime(startTime)}`,
            `DTEND;TZID=Asia/Taipei:${formatTime(endTime)}`,
            `SUMMARY:[${lesson.subject}] ${lesson.class}`,
            `DESCRIPTION:${formattedNotes}`,
            `LOCATION:${lesson.location || ''}`,
            'END:VEVENT'
        ];

        const icsContent = ['BEGIN:VCALENDAR', 'VERSION:2.0', 'PRODID:-//My School//EN', ...eventDetails, 'END:VCALENDAR'].join('\r\n');
        
        const blob = new Blob([icsContent], { type: 'text/calendar' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `${teacherName}-${date}-${lesson.subject}-註記.ics`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }


    // --- MAIN EXECUTION ---
    try {
        const allTeachersWithSchedule = deriveSchedules();
        populateTeacherList(allTeachersWithSchedule);
        populateTeacherListBySubject(allTeachersWithSchedule);
        populateClassList();
        populateLocationList();

        const lastScheduleJSON = localStorage.getItem('lastSchedule');
        let lastSchedule = {};
        if (lastScheduleJSON) {
            lastSchedule = JSON.parse(lastScheduleJSON);
        }

        if (lastSchedule.view === 'subject') {
            currentView = 'subject';
            document.getElementById('teacher-list-container').style.display = 'none';
            document.getElementById('teacher-list-by-subject-container').style.display = 'block';
            document.getElementById('view-by-dept-btn').classList.remove('active');
            document.getElementById('view-by-subject-btn').classList.add('active');
        }

        if (lastSchedule?.type && lastSchedule?.name) {
            setTimeout(() => showSchedule(lastSchedule.type, lastSchedule.name), 100);
        }

    } catch (e) {
        console.error("程式執行時發生嚴重錯誤:", e);
        alert("程式執行時發生嚴重錯誤，請檢查主控台(F12)獲取更多資訊。");
    }

    const mainModal = document.getElementById('schedule-modal');
    const singleEventModal = document.getElementById('single-event-modal');

    document.querySelectorAll('.close-button').forEach(btn => {
        btn.onclick = (e) => {
            const parentModal = e.target.closest('.modal');
            if (parentModal) {
                parentModal.style.display = 'none';
            }
        }
    });

    window.onclick = (event) => {
        if (event.target == mainModal) mainModal.style.display = 'none';
        if (event.target == singleEventModal) singleEventModal.style.display = 'none';
    };
    
    document.getElementById('search-teacher').addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase().trim();
        const container = currentView === 'department' ? deptContainer : subjectContainer;
        
        container.querySelectorAll('.department-table').forEach(table => {
            let tableHasVisibleRow = false;
            table.querySelectorAll('tbody tr').forEach(row => {
                const nameCell = row.querySelector('.name-cell');
                const isVisible = nameCell && nameCell.textContent.toLowerCase().includes(searchTerm);
                row.classList.toggle('hidden', !isVisible);
                if (isVisible) tableHasVisibleRow = true;
            });
            table.classList.toggle('hidden', !tableHasVisibleRow && searchTerm);
        });
    });

    const deptBtn = document.getElementById('view-by-dept-btn');
    const subjectBtn = document.getElementById('view-by-subject-btn');
    const deptContainer = document.getElementById('teacher-list-container');
    const subjectContainer = document.getElementById('teacher-list-by-subject-container');

    const updateView = (newView) => {
        const lastSchedule = JSON.parse(localStorage.getItem('lastSchedule')) || {};
        lastSchedule.view = newView;
        localStorage.setItem('lastSchedule', JSON.stringify(lastSchedule));
        
        document.getElementById('search-teacher').value = '';
        document.querySelectorAll('.department-table, .department-table tr').forEach(el => el.classList.remove('hidden'));

        const isDept = newView === 'department';
        deptContainer.style.display = isDept ? 'block' : 'none';
        subjectContainer.style.display = isDept ? 'none' : 'block';
        deptBtn.classList.toggle('active', isDept);
        subjectBtn.classList.toggle('active', !isDept);
        currentView = newView;
    };

    deptBtn.onclick = () => updateView('department');
    subjectBtn.onclick = () => updateView('subject');
});
</script>

</body>
</html>
